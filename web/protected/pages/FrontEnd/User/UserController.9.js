var PageJs=new Class.create();PageJs.prototype=Object.extend(new FrontPageJs(),{resultDivId:"",pagination:{pageNo:1,pageSize:10},borrowStatusId:"",_getEmptyBookShelfInfo:function(){return new Element("div",{"class":"infobox bg-info iconbtn"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-info-sign"})}).insert({bottom:new Element("span",{"class":"btnname"}).insert({bottom:"您的书架是空的/您的書架是空的"}).insert({bottom:new Element("div").update("Your bookshelf is empty")})})},changePage:function(d,b,a){var c={};c.me=this;c.me.pagination.pageNo=b;c.me.pagination.pageSize=a;jQuery(d.id).button("loading");c.me.showBookShelf(false,function(){$(d).up(".pagination_wrapper").remove()})},_getLoadingDiv:function(){return new Element("span",{"class":"loading"}).insert({bottom:new Element("img",{src:"/themes/default/images/loading.gif"})}).insert({bottom:"Loading ..."})},_getPaginationDiv:function(a){var b={};if(a.pageNumber>=a.totalPages){return}b.me=this;return new Element("div",{"class":"pagination_wrapper"}).insert({bottom:new Element("span",{"class":"btn btn-primary iconbtn",id:"get_more_btn","data-loading-text":"处理中/處理中/Processing..."}).insert({bottom:new Element("span",{"class":"btnname"}).insert({bottom:"查看更多/查看更多"}).insert({bottom:new Element("small").update("Get more")})}).observe("click",function(){b.me.changePage(this,a.pageNumber+1,b.me.pagination.pageSize)})})},showBookShelf:function(a,c){var b={};b.me=this;b.clear=(a===true?true:false);if(b.clear===true){this.pagination.pageNo=1;$(b.me.resultDivId).update(b.me._getLoadingDiv())}pageJs.postAjax(b.me.getCallbackId("getProducts"),{pagination:b.me.pagination},{onLoading:function(){},onComplete:function(d,g){b.resultDiv=$(b.me.resultDivId);if(b.clear===true){b.resultDiv.update("")}try{b.result=pageJs.getResp(g,false,true);if((!b.result.pagination||b.result.pagination.totalRows===0||b.result.items.size()===0)&&$(b.me.resultDivId).getElementsBySelector(".listitem").size()===0){b.resultDiv.update(b.me._getEmptyBookShelfInfo())}b.result.items.each(function(e){b.resultDiv.insert({bottom:b.me._getProductListItem(e)})});if(b.result.pagination.pageNumber<b.result.pagination.totalPages){b.resultDiv.insert({bottom:b.me._getPaginationDiv(b.result.pagination)})}}catch(f){b.resultDiv.insert({bottom:b.me.getAlertBox("ERROR: "+f).addClassName("alert-danger")})}if(typeof(c)==="function"){c()}}});return this},removeItem:function(b,c){var a={};a.me=this;if(!confirm("你确定要从书架中删除这本书吗？/ 你確定要從書架中刪除這本書嗎？\n You are removing this BOOK from your book shelf?\n\n继续/繼續/Continue?")){return}pageJs.postAjax(a.me.getCallbackId("removeProduct"),{itemId:c,pagination:a.me.pagination},{onLoading:function(){jQuery(b.id).button("loading")},onComplete:function(d,g){try{a.result=pageJs.getResp(g,false,true);if(a.result.delItem&&a.result.delItem.id){a.itemRow=$(a.me.resultDivId).down(".listitem[item_id="+a.result.delItem.id+"]");if(a.itemRow){a.itemRow.remove()}}if(a.result.nextItem){if($(a.me.resultDivId).down(".pagination_wrapper")){$(a.me.resultDivId).down(".pagination_wrapper").insert({before:a.me._getProductListItem(a.result.nextItem)})}else{$(a.me.resultDivId).insert({bottom:a.me._getProductListItem(a.result.nextItem)})}}if($(a.me.resultDivId).getElementsBySelector(".listitem").size()===0){$(a.me.resultDivId).update(a.me._getEmptyBookShelfInfo())}}catch(f){$(b).insert({before:a.me.getAlertBox("ERROR: "+f).addClassName("alert-danger")});jQuery(b.id).button("reset")}}});return this},borrowItem:function(b,c){var a={};a.me=this;if(!confirm("You are trying to borrow this BOOK. / 您正试图借这本书. / 您正試圖借這本書. \n\n Continue / 继续 / 繼續 ?")){return}pageJs.postAjax(a.me.getCallbackId("borrowItem"),{itemId:c},{onLoading:function(){$(b).addClassName("disabled loading")},onComplete:function(d,g){try{a.result=pageJs.getResp(g,false,true);if(a.result.item&&a.result.item.id){a.itemRow=$(a.me.resultDivId).down(".listitem[item_id="+a.result.item.id+"]");if(a.itemRow){a.itemRow.replace(a.me._getProductListItem(a.result.item))}}alert("You have successfully borrowed this book./ 您已成功借这本书. / 您已成功借這本書.")}catch(f){$(b).insert({before:a.me.getAlertBox("ERROR: "+f).addClassName("alert-danger")});$(b).removeClassName("disabled loading")}}});return this},returnItem:function(b,c){var a={};a.me=this;if(!confirm("You are trying to return this BOOK./ 你正在试图返回本书. / 你正在試圖返回本書。 \n\n Continue / 继续 / 繼續 ?")){return}pageJs.postAjax(a.me.getCallbackId("returnItem"),{itemId:c},{onLoading:function(){$(b).addClassName("disabled loading")},onComplete:function(d,g){try{a.result=pageJs.getResp(g,false,true);if(a.result.item&&a.result.item.id){a.itemRow=$(a.me.resultDivId).down(".listitem[item_id="+a.result.item.id+"]");if(a.itemRow){a.itemRow.replace(a.me._getProductListItem(a.result.item))}}alert("You have successfully returned this book. / 您已成功返回本书。 / 您已成功返回本書。")}catch(f){$(b).insert({before:a.me.getAlertBox("ERROR: "+f).addClassName("alert-danger")});$(b).removeClassName("disabled loading")}}});return this},_getBtnDiv:function(b){var a={};a.me=this;a.newDiv=new Element("div",{"class":"row btns"}).insert({bottom:new Element("div",{"class":"col-xs-12"}).insert({bottom:new Element("span",{"class":"btn btn-danger btn-sm iconbtn",id:"removebtn_"+b.id,"data-loading-text":"处理中/處理中/Processing..."}).insert({bottom:new Element("span",{"class":"btnname"}).update("从我的书架中删除 / 從我的書架中刪除").insert({bottom:new Element("small").update("Remove From My Bookshelf")})}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(){a.me.removeItem(this,b.id)})})});return a.newDiv},_getProductListItemDetailsRow:function(d,b,c,a){return new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-6"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-5"}).insert({bottom:new Element("strong").insert({bottom:d})})}).insert({bottom:new Element("div",{"class":"col-sm-7"}).update(b)})})}).insert({bottom:new Element("div",{"class":"col-sm-6"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-5"}).insert({bottom:new Element("strong").insert({bottom:c})})}).insert({bottom:new Element("div",{"class":"col-sm-7"}).update(a)})})})},_getProductListItem:function(b){var a={};a.me=this;if(!b.product||!b.product.id){return null}a.productDiv=new Element("div",{"class":"panel panel-default listitem",item_id:b.id}).store("data",b).insert({bottom:new Element("div",{"class":"panel-body"}).insert({bottom:new Element("div",{"class":"row nodefault plistitem"}).insert({bottom:new Element("div",{"class":"col-xs-4 col-sm-3"}).insert({bottom:new Element("div",{"class":"thumbnail"}).insert({bottom:new Element("a",{href:a.me.getProductDetailsUrl(b.product.id)}).insert({bottom:a.me._getProductImgDiv(b.product.attributes.image_thumb||null).addClassName("img-thumbnail")})})})}).insert({bottom:new Element("div",{"class":"col-xs-8 col-sm-9"}).insert({bottom:new Element("a",{"class":"product_title",href:a.me.getProductDetailsUrl(b.product.id)}).insert({bottom:new Element("h4").update(b.product.title)})}).insert({bottom:a.me._getProductListItemDetailsRow("Author:",(b.product.attributes.author?a.me._getAttrString(b.product.attributes.author).join(" "):""),"ISBN:",(b.product.attributes.isbn?a.me._getAttrString(b.product.attributes.isbn).join(" "):""))}).insert({bottom:a.me._getProductListItemDetailsRow("Publisher:",(b.product.attributes.publisher?a.me._getAttrString(b.product.attributes.publisher).join(" "):""),"Pub. Date:",(b.product.attributes.publish_date?a.me._getAttrString(b.product.attributes.publish_date).join(" "):""))}).insert({bottom:a.me._getProductListItemDetailsRow("Borrowed @:",(b.borrowTime?b.borrowTime:""),"Expiry:",(b.expiryTime?b.expiryTime:""))}).insert({bottom:a.me._getBtnDiv(b)}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("small").insert({bottom:b.product.attributes.description?a.me._getAttrString(b.product.attributes.description).join(" "):""})})})})})});return a.productDiv},_getAttrString:function(a){return a.map(function(b){return b.attribute||""})}});